{{- /* === Basic meta ================================ */ -}}
{{- $title     := cond (ne .Title "") .Title .Site.Title -}}
{{- $desc      := or .Params.description .Site.Params.description | default "" -}}
{{- $imageRel  := or .Params.image "/og/pfemeter-cover.jpg" -}}
{{- $image     := $imageRel | absURL -}}
{{- $canonical := .Permalink -}}

<title>{{ $title }} | {{ .Site.Title }}</title>
<meta name="description" content="{{ $desc }}">
{{- with .Params.keywords }}<meta name="keywords" content="{{ delimit . ", " }}">{{ end -}}
<link rel="canonical" href="{{ $canonical }}">

{{- /* === Open Graph / Twitter ====================== */ -}}
<meta property="og:type" content="website">
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $desc }}">
<meta property="og:url" content="{{ $canonical }}">
<meta property="og:image" content="{{ $image }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="{{ .Site.Language.Lang }}_AT">
{{- range .AllTranslations }}
<meta property="og:locale:alternate" content="{{ .Language.Lang }}_AT">
{{- end }}

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $desc }}">
<meta name="twitter:image" content="{{ $image }}">

{{- /* === hreflang alternates ======================== */ -}}
<link rel="alternate" href="{{ .Permalink }}" hreflang="{{ .Site.Language.Lang }}">
{{- range .AllTranslations }}
<link rel="alternate" href="{{ .Permalink }}" hreflang="{{ .Language.Lang }}">
{{- end }}
<link rel="alternate" href="{{ .Permalink }}" hreflang="x-default">

{{- /* === JSON-LD: Organization + WebSite ============ */ -}}
<script type="application/ld+json">
{{- $b := .Site.Params.business -}}
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ .Site.Title | jsonify }},
  "url": {{ .Site.BaseURL | jsonify }},
  "logo": {{ (or $b.logo "/og/pfemeter-logo.png" | absURL) | jsonify }},
  "sameAs": {{ (or $b.sameAs (slice)) | jsonify }},
  "description": {{ $desc | jsonify }}
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": {{ .Site.BaseURL | jsonify }},
  "name": {{ .Site.Title | jsonify }},
  "inLanguage": "{{ .Site.Language.Lang }}"
}
</script>

{{- /* === JSON-LD: ProfessionalService =============== */ -}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ProfessionalService",
  "name": {{ .Site.Title | jsonify }},
  "url": {{ .Site.BaseURL | jsonify }},
  "image": {{ $image | jsonify }},
  "description": {{ $desc | jsonify }},
  "areaServed": { "@type": "AdministrativeArea", "name": "Wien" },
  "address": {
    "@type": "PostalAddress",
    "streetAddress": {{ or $b.address.street "" | jsonify }},
    "addressLocality": {{ or $b.address.city "Wien" | jsonify }},
    "postalCode": {{ or $b.address.postcode "" | jsonify }},
    "addressCountry": {{ or $b.address.country "AT" | jsonify }}
  }
}
</script>

{{- /* === Optional: JSON-LD Service für Sparten ===== */ -}}
{{- if eq .Params.type "sparte" -}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Service",
  "name": {{ .Title | jsonify }},
  "url": {{ .Permalink | jsonify }},
  "provider": { "@type": "Organization", "name": {{ .Site.Title | jsonify }}, "url": {{ .Site.BaseURL | jsonify }}},
  "areaServed": "Wien, Österreich",
  "description": {{ (or .Params.description $desc) | jsonify }},
  "image": {{ $image | jsonify }}
}
</script>
{{- end -}}
